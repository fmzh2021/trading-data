name: 股票实时监控

on:
  schedule:
    # 每个交易日的 9:30, 10:00, 11:00, 13:00, 14:00, 15:00 (北京时间) 执行
    # UTC 时间需要减 8 小时
    - cron: '30 1,2,3,5,6,7 * * 1-5'  # 周一至周五
  workflow_dispatch:  # 允许手动触发
    inputs:
      stock_codes:
        description: '股票代码（多个用逗号分隔，如: 600036,000001,300001）'
        required: false
        default: '600036'
        type: string

jobs:
  monitor:
    runs-on: ubuntu-latest
    steps:
      - name: 检出代码
        uses: actions/checkout@v3

      - name: 设置 Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: 安装依赖
        run: |
          pip install -r requirements.txt

      - name: 运行股票监控
        env:
          # 股票代码配置优先级：手动输入 > repository variables > secrets > 默认值
          INPUT_CODES: ${{ inputs.stock_codes }}
          VAR_CODES: ${{ vars.STOCK_CODES }}
          SECRET_CODES: ${{ secrets.STOCK_CODES }}
        run: |
          # 按优先级选择股票代码：手动输入 > repository variables > secrets > 默认值
          if [ -n "$INPUT_CODES" ]; then
            STOCK_CODES="$INPUT_CODES"
          elif [ -n "$VAR_CODES" ]; then
            STOCK_CODES="$VAR_CODES"
          elif [ -n "$SECRET_CODES" ]; then
            STOCK_CODES="$SECRET_CODES"
          else
            STOCK_CODES="600036"
          fi
          echo "监控股票代码: $STOCK_CODES"
          export STOCK_CODES
          python stock_monitor.py

